<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Punainen Elefantti AR</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

<style>
body { margin: 0; overflow: hidden; }
#info {
    position: absolute;
    top: 20px;
    width: 100%;
    text-align: center;
    color: white;
    font-size: 18px;
    z-index: 1;
}
</style>
</head>

<body>

<div id="info">Liikuta kameraa lattiaan ja napauta näyttöä</div>

<a-scene
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true;"
    webxr="requiredFeatures: hit-test, local-floor"
    xr-mode-ui="enabled: true">

    <a-assets>
        <a-asset-item id="elephantModel" src="elefantti.glb"></a-asset-item>
    </a-assets>

    <a-camera position="0 1.6 0"></a-camera>

    <!-- Reticle -->
    <a-entity id="reticle"
        geometry="primitive: ring; radiusInner: 0.08; radiusOuter: 0.1"
        material="color: white; shader: flat"
        rotation="-90 0 0"
        visible="false">
    </a-entity>

    <!-- Elephant -->
    <a-entity id="elephant"
        gltf-model="#elephantModel"
        scale="0.5 0.5 0.5"
        visible="false">
    </a-entity>

</a-scene>

<script>
const scene = document.querySelector('a-scene');
const reticle = document.querySelector('#reticle');
const elephant = document.querySelector('#elephant');

scene.addEventListener("enter-vr", () => {
    if (scene.is("ar-mode")) {
        const xrSession = scene.renderer.xr.getSession();

        xrSession.requestReferenceSpace("viewer").then((referenceSpace) => {
            xrSession.requestHitTestSource({ space: referenceSpace }).then((hitTestSource) => {

                scene.renderer.xr.addEventListener("sessionend", () => {
                    hitTestSource.cancel();
                });

                scene.renderer.xr.setAnimationLoop((timestamp, frame) => {
                    if (!frame) return;

                    const referenceSpace = scene.renderer.xr.getReferenceSpace();
                    const hitTestResults = frame.getHitTestResults(hitTestSource);

                    if (hitTestResults.length > 0) {
                        const hit = hitTestResults[0];
                        const pose = hit.getPose(referenceSpace);

                        reticle.setAttribute("visible", true);
                        reticle.object3D.position.set(
                            pose.transform.position.x,
                            pose.transform.position.y,
                            pose.transform.position.z
                        );
                    }
                });
            });
        });
    }
});

scene.addEventListener("click", () => {
    if (reticle.getAttribute("visible")) {
        elephant.setAttribute("visible", true);
        elephant.object3D.position.copy(reticle.object3D.position);
    }
});
</script>

</body>
</html> 
